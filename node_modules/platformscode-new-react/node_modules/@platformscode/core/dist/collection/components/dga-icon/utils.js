import { getAssetPath } from "@stencil/core";
let CACHED_MAP;
export const getIconMap = () => {
    if (typeof window === 'undefined') {
        return new Map();
    }
    else {
        if (!CACHED_MAP) {
            const win = window;
            win.GDSIcons = win.GDSIcons || {};
            CACHED_MAP = win.GDSIcons.map = win.GDSIcons.map || new Map();
        }
        return CACHED_MAP;
    }
};
/**
 * Convert ordinal numbers and special cases to words to create valid JavaScript identifiers
 */
export const ordinalToWord = (name) => {
    const ordinalMap = {
        '1st': 'First',
        '2nd': 'Second',
        '3rd': 'Third',
        '3-d': 'ThreeD',
        '3d': 'ThreeD',
        '4-k': 'FourK',
        '4k': 'FourK',
    };
    // First handle special character replacements that need to be treated as separate words
    let processedName = name.replace(/\+\+/g, '-plus-plus');
    // Remove spaces and replace with hyphens for consistent processing
    processedName = processedName.replace(/\s+/g, '-');
    // Apply ordinal conversions
    processedName = processedName.replace(/\b(1st|2nd|3rd|3-d|4-k|4k|3d)\b/g, (match) => ordinalMap[match] || match);
    return processedName;
};
export const addIcons = (icons) => {
    Object.keys(icons).forEach((name) => {
        addToIconMap(name, icons[name]);
        /**
         * Developers can also pass in the SVG object directly
         * and GDS Icons can map the object to a kebab case name.
         * Example: addIcons({ addCircleOutline });
         * This will create an "addCircleOutline" entry and
         * an "add-circle-outline" entry.
         * Usage: <ion-icon name="add-circle-outline"></ion-icon>
         * Using name="addCircleOutline" is valid too, but the
         * kebab case naming is preferred.
         */
        const toKebabCase = name.replace(/([a-z0-9]|(?=[A-Z]))([A-Z0-9])/g, '$1-$2').toLowerCase();
        if (name !== toKebabCase) {
            addToIconMap(toKebabCase, icons[name]);
        }
    });
};
const addToIconMap = (name, data) => {
    const map = getIconMap();
    const existingIcon = map.get(name);
    if (existingIcon === undefined) {
        map.set(name, data);
        /**
         * Importing and defining the same icon reference
         * multiple times should not yield a warning.
         */
    }
    else if (existingIcon !== data) {
        console.warn(`[GDS Icons Warning]: Multiple icons were mapped to name "${name}". Ensure that multiple icons are not mapped to the same icon name.`);
    }
};
export const getUrl = (i) => {
    let url = getSrc(i.src);
    if (url) {
        return url;
    }
    url = getName(i.name, i.icon);
    if (url) {
        return getNamedUrl(url, i);
    }
    if (i.icon) {
        url = getSrc(i.icon);
        if (url) {
            return url;
        }
    }
    return null;
};
const getNamedUrl = (iconName, iconEl) => {
    const url = getIconMap().get(iconName);
    if (url) {
        return url;
    }
    try {
        // Get variant and type from the icon element, with defaults
        const variant = iconEl.variant || 'bulk';
        const type = iconEl.type || 'rounded';
        // Construct path with variant-type folder structure
        const assetPath = `assets/svg/${variant}-${type}/${iconName}-${variant}-${type}.svg`;
        const result = getAssetPath(assetPath);
        return result;
    }
    catch (e) {
        console.log('e', e);
        /**
         * In the custom elements build version of gds-icons, referencing an icon
         * by name will throw an invalid URL error because the asset path is not defined.
         * This catches that error and logs something that is more developer-friendly.
         * We also include a reference to the ion-icon element so developers can
         * figure out which instance of ion-icon needs to be updated.
         */
        console.warn(`[GDS Icons Warning]: Could not load icon with name "${iconName}". Ensure that the icon is registered using addIcons or that the icon SVG data is passed directly to the icon component.`, iconEl);
    }
};
export const getName = (iconName, icon) => {
    if (!iconName && icon && !isSrc(icon)) {
        iconName = icon;
    }
    if (isStr(iconName)) {
        iconName = toLower(iconName);
    }
    if (!isStr(iconName) || iconName.trim() === '') {
        return null;
    }
    // only allow alpha characters and dash
    const invalidChars = iconName.replace(/[a-z]|-|\d/gi, '');
    if (invalidChars !== '') {
        return null;
    }
    return iconName;
};
export const getSrc = (src) => {
    if (isStr(src)) {
        src = src.trim();
        if (isSrc(src)) {
            return src;
        }
    }
    return null;
};
export const isSrc = (str) => str.length > 0 && /(\/|\.)/.test(str);
export const isStr = (val) => typeof val === 'string';
export const toLower = (val) => val.toLowerCase();
