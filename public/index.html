<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <title>مدقق مواقع SDA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap"
      rel="stylesheet">
    <style>
    :root {
      --background: 0 0% 100%;
      --foreground: 200 20% 15%;

      --card: 0 0% 100%;
      --card-foreground: 200 20% 15%;

      --popover: 0 0% 100%;
      --popover-foreground: 200 20% 15%;

      /* Saudi government blue */
      --primary: 200 80% 35%;
      --primary-foreground: 0 0% 100%;
      /* Primary/Secondary hex colors (used for UI elements) */
      --primary-color: #062c6e;
      --primary-rgba-08: rgba(6,44,110,0.08);
      --primary-rgba-12: rgba(6,44,110,0.12);
      --secondary-color: #2db9db;
      --secondary-rgba-12: rgba(45,185,219,0.12);
      
      /* Saudi green accent */
      --secondary: 145 65% 40%;
      --secondary-foreground: 0 0% 100%;

      --muted: 200 20% 96%;
      --muted-foreground: 200 15% 45%;

      --accent: 145 65% 40%;
      --accent-foreground: 0 0% 100%;
      /* Accent tied to secondary hex for UI elements */
      --accent-color: var(--secondary-color);

      --destructive: 0 70% 50%;
      --destructive-foreground: 0 0% 100%;

      --border: 200 20% 88%;
      --input: 200 20% 88%;
      --ring: 200 80% 35%;

      --success: 145 65% 40%;
      --success-foreground: 0 0% 100%;
      
      --warning: 40 95% 50%;
      --warning-foreground: 200 20% 15%;

      --radius: 0.5rem;

      /* Gradients */
      --gradient-primary: linear-gradient(135deg, #062c6e, hsl(200 70% 45%));
      --gradient-hero: linear-gradient(135deg, #062c6e 0%, hsl(145 65% 40%) 100%);
      
      /* Shadows */
      --shadow-sm: 0 2px 8px hsl(200 20% 15% / 0.08);
      --shadow-md: 0 4px 16px hsl(200 20% 15% / 0.12);
      --shadow-lg: 0 8px 32px hsl(200 20% 15% / 0.16);
    }
    html,body{height:100%;}
  body{font-family:'IBM Plex Sans Arabic', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background: hsl(var(--background)); color: hsl(var(--foreground));}
  .container{max-width:1200px;margin:0 auto;padding:0 18px}
    .card{background: hsl(var(--card)); color: hsl(var(--card-foreground)); width:100%; margin:36px auto; border-radius:calc(var(--radius) * 1); box-shadow:var(--shadow-lg); padding:36px 28px; display:block}
    .card-header{display:flex;align-items:center;gap:16px}
    .header-actions{margin-inline-start:auto;display:flex;gap:8px;align-items:center}
    .hero{text-align:center;padding:8px 12px}
    .hero h1{font-size:40px;line-height:1.15;margin:6px 0 10px;color:var(--primary-color)}
    .hero p.lead{max-width:820px;margin:0 auto;color:var(--muted);font-size:16px}
    .search-card{background: hsl(var(--card));border-radius:calc(var(--radius));box-shadow:var(--shadow-md);padding:18px;display:flex;align-items:center;gap:16px;margin:20px auto;width:auto;max-width:none}
    .search-card .primary{padding:14px 22px;border-radius:calc(var(--radius));font-size:16px;background:var(--primary-color);color:hsl(var(--primary-foreground));border:none}
    .features-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:18px}
    .features-box{max-width:980px;margin:18px auto;padding:18px;border-radius:calc(var(--radius));background:hsl(var(--card));border:1px solid hsl(var(--border));box-shadow:var(--shadow-sm)}
    .feature-card{background: hsl(var(--card));border:1px solid hsl(var(--border));border-radius:calc(var(--radius));padding:22px 18px;text-align:center;box-shadow:var(--shadow-sm)}
    .feature-card .icon{width:56px;height:56px;border-radius:12px;background:var(--secondary-rgba-12);color:hsl(var(--secondary-foreground));display:inline-flex;align-items:center;justify-content:center;margin:0 auto 12px}
    .feature-card .icon svg{width:28px;height:28px;stroke:currentColor;fill:none;stroke-width:1.6}
    .logo{display:flex; align-items:center; gap:14px}
  .logo .mark{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,var(--primary-color),#062c6e);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    h1{font-size:24px;margin:0;color:var(--primary-color)}
    p.lead{color:var(--muted);margin-top:6px;margin-bottom:18px}
    form{display:flex;flex-direction:column;gap:12px}
    /* modern search box */
    .search {
      display:flex;align-items:center;gap:10px;background:hsl(var(--input));padding:10px;border-radius:12px;border:1px solid hsl(var(--border));transition:box-shadow .18s ease,border-color .18s ease;min-width:350px;width:100%;
    }
  /* When the search gains focus make it flexible (auto) up to a max width */
  .search:focus-within{border-color:rgba(6,44,110,0.14);box-shadow:0 8px 24px rgba(2,6,23,0.06);width:auto;max-width:640px}
    .search svg{width:20px;height:20px;flex:0 0 20px;fill:var(--muted);opacity:0.95}
    #website-url{border:none;background:transparent;padding:10px 8px;font-size:15px;outline:none;direction:ltr;min-width:160px;width:auto}
    .search .hint{font-size:12px;color:var(--muted);margin-top:4px}
    .controls{display:flex;gap:8px;align-items:center}
    .controls-block{width:220px;display:flex;flex-direction:column;gap:8px}
    button.primary{background:var(--primary-color);color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6eefc;padding:10px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
    .status{margin-top:12px;color:var(--primary-color);min-height:28px;display:flex;align-items:center;gap:10px}
    .loader{width:18px;height:18px;border:3px solid #e6eefc;border-top-color:var(--primary-color);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  .result-link{display:inline-block;margin-top:8px;padding:8px 10px;background:var(--accent-color);color:#fff;border-radius:8px;text-decoration:none}

  /* Center the compact scan panel on the page and its actions */
  #scan-panel-top { text-align: center; margin:12px auto; display:block; max-width:720px; }
  #scan-panel-top .scan-actions { display:flex; justify-content:center; gap:8px; margin-top:10px }

  /* Boxed search inner wrapper to constrain width and center the controls */
  .search-box-inner { max-width:920px; margin:0 auto; display:flex; align-items:center; gap:12px; width:100%; }
  .search-box-inner form { width:100%; display:flex; gap:12px; align-items:center; }
  /* Move the action button visually to the left (start) in the flex layout so it appears on the left in RTL */
  .search-box-inner form > div:last-child { order: -1; }

  /* Style the report button to use the accent color when visible */
  button.ghost#open-report{background:var(--accent-color);color:hsl(var(--accent-foreground));border:none;padding:10px 12px}
  button.ghost#open-report:hover{filter:brightness(.96)}
    .right-panel{background:hsl(var(--popover));border-radius:calc(var(--radius));padding:18px;border:1px solid hsl(var(--border));max-width:360px;width:100%}
    .card > div:first-child{padding-right:12px}
    .card > div:first-child .lead{max-width:680px;color:hsl(var(--muted-foreground))}
    button.ghost#open-report{padding:10px 14px;min-width:110px}
    button.primary{min-width:140px}
    .hidden{display:none !important;visibility:hidden;opacity:0}
    .step{display:flex;align-items:center;gap:12px;padding:8px 0}
    .step svg{width:48px;height:48px;flex:0 0 48px}
    .step .dot{width:10px;height:10px;border-radius:50%;background:#e6eefc}
    .step.active .dot{background:var(--primary-color)}
    .muted{color:hsl(var(--muted-foreground))}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:1200px){.card{max-width:920px}}
    @media (max-width:980px){.card{max-width:720px;padding:24px}.logo .mark{width:56px;height:56px}.hero h1{font-size:30px}.features-grid{grid-template-columns:repeat(2,1fr)}.search-card{flex-direction:column;align-items:stretch}.search-card .primary{width:100%}.card-header{flex-direction:column;align-items:center}.header-actions{margin-inline-start:0;margin-top:12px}}
    @media (max-width:520px){
      .card{padding:18px;max-width:420px}
      .logo .mark{width:48px;height:48px;font-size:16px}
      .hero h1{font-size:22px}
      .features-grid{grid-template-columns:1fr}
      .step svg{width:28px;height:28px}
      .search-card{padding:12px;flex-direction:column;align-items:stretch}
      .search-card button.primary{width:100%;order:0}
      /* On small screens keep the search container boxed (full width of card) */
      .search{width:100%;min-width:unset;max-width:none}
      .search-box-inner{flex-direction:column;align-items:stretch}
      .search-box-inner form{flex-direction:column;align-items:stretch}
      .search-box-inner form > div{width:100%}
      .search-box-inner form > div:last-child{order:0}
      /* Make the input and icons adapt to the boxed container */
      #website-url{width:100%;min-width:unset}
      .search svg{flex:0 0 20px}
      /* Ensure focus doesn't expand beyond the card on mobile */
      .search:focus-within{width:100%;max-width:none;border-color:rgba(6,44,110,0.14);box-shadow:0 8px 24px rgba(2,6,23,0.06)}
      .search .search-input{font-size:15px}
    }

    /* Responsive rules for the compact scan panel */
    /* Keep the panel centered and scale it on smaller screens */
    @media (min-width:721px) and (max-width:1200px) {
      #scan-panel-top { max-width:640px; }
    }

    @media (max-width:720px) {
      /* Use almost full width on small viewports and ensure padding fits */
      #scan-panel-top { max-width:92%; margin:12px auto; padding:12px; box-sizing:border-box; }
      /* Keep actions centered and allow wrapping for multiple buttons */
      #scan-panel-top .scan-actions { justify-content:center; flex-wrap:wrap; gap:6px }
      /* Make the report button easier to tap on small screens */
      #scan-panel-top .scan-actions button, #scan-panel-top button#open-report { width:100%; max-width:360px; margin:6px auto 0; display:block }
    }
  </style>
  </head>
  <body>
    <!-- Sticky header (matches React layout) -->
    <header class="site-header"
      style="position:sticky;top:0;z-index:50;background:transparent;backdrop-filter:blur(6px);">
      <div class="container"
        style="border-bottom:1px solid hsl(var(--border)/0.6);">
        <div
          style="display:flex;align-items:center;justify-content:space-between;padding:12px 0">
          <div style="display:flex;align-items:center;gap:12px">
            <div
              style="width:40px;height:40px;border-radius:8px;background:var(--primary-color);display:flex;align-items:center;justify-content:center;color:hsl(var(--primary-foreground));font-weight:700">SDA</div>
            <div>
              <div style="font-weight:700;color:hsl(var(--foreground))">مدقق كود
                المنصات الموحد</div>
              <div style="font-size:12px;color:hsl(var(--muted-foreground))">DGA
                Unified Design Code Validator</div>
            </div>
          </div>
          <div>
            <button class="ghost"
              onclick="window.open('https://ramworld.net','_blank')"
              aria-label="site"
              style="display:inline-flex;align-items:center;gap:8px;padding:6px 8px">
              <img
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ0C8AdcJDIDRyV-2Yz3wyd2YNzhxAWd4LH8w&s"
                alt="Ramworld"
                style="width:30px;height:auto;border-radius:1px;object-fit:contain;display:inline-block">
              <span
                style="font-size:13px;line-height:1.15;color:var(--muted-foreground)">Ramworld
                Tech Solutions</span>
            </button>
          </div>

        </div>
      </div>
    </header>

    <div class="card" role="main">
      <div>
        <div class="hero" style="text-align:center">
          <div
            style="display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;background:var(--primary-rgba-08);color:var(--primary-color);border:1px solid var(--primary-rgba-12);margin:0 auto;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
              aria-hidden><path d="M12 2L12 12" stroke="currentColor"
                stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" /></svg>
            <span style="font-size:13px;font-weight:600">أداة التحقق التجريبية
              من عالم رام لحلول التفنية</span>
          </div>
          <h1 style="margin-top:18px;font-size:40px;line-height:1.15">تحقق من
            توافق موقعك مع<br><span style="color:var(--primary-color)">معايير
              الهيئة السعودية للحكومة الرقمية</span></h1>
          <p class="lead" style="margin-top:10px">أداة ذكاء اصطناعي متقدمة تفحص
            56 معياراً من معايير نظام التصميم الموحد وتقدم توصيات محددة
            للتحسين</p>
        </div>

        <div class="search-card">
          <div class="search-box" style="width:100%">
            <div class="search-box-inner"
              style="max-width:920px;margin:0 auto;display:flex;align-items:center;gap:12px;">
              <form id="scan-form" aria-label="scan form"
                style="display:flex;gap:12px;align-items:center;flex:1;width:100%">
                <div style="flex:1;min-width:0">
                  <label class="muted" for="website-url">أدخل رابط الموقع أو
                    النطاق</label>
                  <div class="search" role="search">
                    <svg viewBox="0 0 24 24" aria-hidden="true"><path
                        d="M21.53 20.47l-4.82-4.82a7 7 0 10-1.06 1.06l4.82 4.82a.75.75 0 101.06-1.06zM10.5 17a6.5 6.5 0 110-13 6.5 6.5 0 010 13z"
                        fill="currentColor"></path></svg>
                    <input class="search-input" type="text" id="website-url"
                      name="website-url"
                      placeholder="أدخل رابط الموقع (مثال: dga.gov.sa أو https://example.gov.sa)"
                      inputmode="url" required autocomplete="off"
                      aria-label="رابط الموقع">
                  </div>
                  <div class="muted" style="font-size:12px;margin-top:6px">يمكنك
                    إدخال النطاق فقط وسيُضاف البروتوكول تلقائياً.</div>
                </div>
                <div
                  style="display:flex;flex-direction:column;gap:8px;align-items:flex-start">

                </div>

              </form><div style="display:flex;align-items:center;gap:8px">
                <button class="primary" type="button"
                  onclick="document.getElementById('scan-form').dispatchEvent(new Event('submit',{cancelable:true,bubbles:true}))">ابدأ
                  الفحص</button>
              </div><div style="display:flex;align-items:center;gap:8px">
                <input type="checkbox" id="fast-mode" name="fast-mode" />
                <label for="fast-mode" class="muted" style="font-size:13px">وضع
                  سريع</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Compact scan panel shown under the search card for immediate feedback -->
        <div id="scan-panel-top" class="right-panel hidden" aria-hidden="true"
          style="margin-top:12px;">
          <h3 class="muted">حالة الفحص</h3>
          <div style="margin-top:6px" class="status" id="scan-progress-top"
            aria-live="polite"></div>
        </div>

        <div style="margin-top:18px">
          <div class="features-box">
            <div class="features-grid">
              <div class="feature-card">
                <div class="icon" style="color:var(--accent-color);">
                  <!-- Globe outline -->
                  <svg viewBox="0 0 24 24" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"><path
                      d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path><path d="M2.05 12h19.9"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path><path d="M12 2.05v19.9"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path></svg>
                </div>
                <strong>توصيات عملية</strong>
                <div class="muted">توصيات محددة وقابلة للتنفيذ لكل معيار</div>
              </div>
              <div class="feature-card">
                <div class="icon" style="color:var(--secondary-color);">
                  <!-- Shield outline -->
                  <svg viewBox="0 0 24 24" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"><path
                      d="M12 2l7 3v5c0 5-3.58 9.74-7 12-3.42-2.26-7-7-7-12V5l7-3z"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path></svg>
                </div>
                <strong>تحليل بالذكاء الاصطناعي</strong>
                <div class="muted">تحليل متقدم لاكتشاف نماذج الانحراف
                  والاقتراحات</div>
              </div>
              <div class="feature-card">
                <div class="icon" style="color:var(--primary-color);">
                  <!-- Check circle outline -->
                  <svg viewBox="0 0 24 24" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12"
                      r="9" stroke-linecap="round"
                      stroke-linejoin="round"></circle><path d="M9 12l2 2 4-4"
                      stroke-linecap="round"
                      stroke-linejoin="round"></path></svg>
                </div>
                <strong>56 معياراً شاملة</strong>
                <div class="muted">فحص شامل لجميع معايير نظام التصميم
                  الموحد</div>
              </div>
            </div>
          </div>

          <div id="scan-panel" class="right-panel hidden" aria-hidden="true">
            <h3 class="muted">حالة الفحص</h3>
            <div class="step active"><div class="dot"></div><div><strong>1.
                  إرسال الرابط</strong><div class="muted">سنرسل الرابط إلى
                  الخادم لتنفيذ الفحص</div></div></div>
            <div class="step" id="step-2"><div class="dot"></div><div><strong>2.
                  تحليل الصفحة</strong><div class="muted">استخراج ألوان، خطوط
                  وقيم المسافات</div></div></div>
            <div class="step" id="step-3"><div class="dot"></div><div><strong>3.
                  حفظ التقرير</strong><div class="muted">حفظ تقرير HTML و JSON
                  في مجلد reports</div></div></div>
            <div style="margin-top:12px" class="status" id="scan-progress"
              aria-live="polite"></div>
          </div>
        </div>

      </div>
    </div>

    <script>
    const form = document.getElementById('scan-form');
    const progress = document.getElementById('scan-progress');
    const progressTop = document.getElementById('scan-progress-top');
    const step2 = document.getElementById('step-2');
    const step3 = document.getElementById('step-3');

    // Detect when the page is opened locally (file://) or without a hostname and
    // default the backend to the known local server so the health check works.
    const DEFAULT_BACKEND = 'http://localhost:3001';
    let backendUrl;
    if (window.location.protocol === 'file:' || !window.location.hostname) {
      backendUrl = DEFAULT_BACKEND;
    } else if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
      backendUrl = DEFAULT_BACKEND;
    } else {
      backendUrl = `${window.location.protocol}//${window.location.hostname}${window.location.port ? ':' + window.location.port : ''}`;
    }

    function setStatus(text, busy=false){
      // Update both progress targets if available so users see feedback immediately
      const targets = [progressTop, progress].filter(Boolean);
      targets.forEach(t => { t.textContent = ''; if(busy){ const loader = document.createElement('span'); loader.className='loader'; t.appendChild(loader); } const span = document.createElement('span'); span.textContent = text; span.style.marginInlineStart='8px'; t.appendChild(span); });
    }

    // Helper: show the "open report" button and set its link to the backend reports path
    // The button will be placed inside the compact scan panel (`#scan-panel-top`) and centered.
    function showReportButton() {
      let btn = document.getElementById('open-report');
      const panelTop = document.getElementById('scan-panel-top');
      // If the button does not exist, create it
      if (!btn) {
        btn = document.createElement('button');
        btn.id = 'open-report';
        btn.className = 'ghost';
        btn.type = 'button';
        btn.textContent = 'عرض التقرير';
        btn.setAttribute('aria-hidden', 'false');
        btn.onclick = () => window.open(`${backendUrl}/reports/report.html`, '_blank');
      }

      // Ensure the compact scan panel is visible
      if (panelTop) {
        panelTop.classList.remove('hidden');
        panelTop.setAttribute('aria-hidden', 'false');
        // create or reuse an actions container inside panelTop
        let actions = panelTop.querySelector('.scan-actions');
        if (!actions) {
          actions = document.createElement('div');
          actions.className = 'scan-actions';
          panelTop.appendChild(actions);
        }
        // Avoid duplicating the button inside the container
        if (!actions.contains(btn)) {
          actions.appendChild(btn);
        }
        btn.classList.remove('hidden');
        try{ btn.focus(); }catch(e){}
      } else {
        // Fallback: place near the search card
        const searchCard = document.querySelector('.search-card');
        if (searchCard && searchCard.parentNode && !document.getElementById('open-report')) {
          searchCard.parentNode.insertBefore(btn, searchCard.nextSibling);
        }
      }
    }

    // Check if a report is available on the backend; show the button if so.
    // Some environments (file:// or strict CORS) may block HEAD requests; fall
    // back to a health check so users opening the page locally still see the
    // report button when the backend is reachable.
    async function checkReportAvailable() {
      try {
        // Try a lightweight HEAD first (fast)
        const r = await fetch(`${backendUrl}/reports/report.html`, { method: 'HEAD' });
        if (r && r.ok) {
          showReportButton();
          return;
        }
      } catch (e) {
        // proceed to health fallback
      }

      // Fallback: if the backend is alive, show the button (report may exist)
      try {
        const h = await fetch(`${backendUrl}/health`, { method: 'GET' });
        if (h && h.ok) {
          showReportButton();
        }
      } catch (e) {
        // Still ignore — leave button hidden
      }
    }

    // Do NOT auto-show the report button on load — only show after a successful scan
    // (checkReportAvailable intentionally not called here)

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      let raw = document.getElementById('website-url').value.trim();
      // Normalize: if user enters domain only, add https://
      let url = raw;
      if (!/^https?:\/\//i.test(url)) {
        // Basic domain validation (very light): contains at least one dot and no spaces
        if (!/^[\w.-]+\.[a-z]{2,}$/i.test(url)) {
          setStatus('الرجاء إدخال دومين صالح مثل example.gov.sa', false);
          return;
        }
        url = 'https://' + url;
      }
      // Show normalized URL to the user
      setStatus('جاري الفحص: ' + url, true);
      step2.classList.add('active');
      // Reveal the scan status panels (compact top and full right) and bring the top one into view
      try {
        // Only show the compact scan status under the search bar to avoid duplicate
        // "حالة الفحص" panels. Keep the right-hand detailed panel hidden.
        const panel = document.getElementById('scan-panel');
        const panelTop = document.getElementById('scan-panel-top');
        if (panel) {
          panel.classList.add('hidden');
          panel.setAttribute('aria-hidden', 'true');
        }
        if (panelTop) {
          panelTop.classList.remove('hidden');
          panelTop.setAttribute('aria-hidden', 'false');
          panelTop.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      } catch (e) { /* ignore scrolling errors */ }
      try{
        // quick health check to fail fast with clearer messaging
        const health = await fetch(`${backendUrl}/health`, { method: 'GET' });
        if (!health.ok) {
          setStatus('الخادم غير متاح (health check failed)');
          return;
        }

  const fastMode = !!document.getElementById('fast-mode').checked;
  const res = await fetch(`${backendUrl}/scan`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({url, fastMode})});
        if(res.ok){
          setStatus('تم الفحص بنجاح');
          step3.classList.add('active');
          showReportButton();
        } else {
          const data = await res.json().catch(()=>({error:'خطأ في الخادم'}));
          setStatus('فشل الفحص: ' + (data.error || 'خطأ غير معروف'));
        }
      }catch(err){
        // Provide more helpful guidance for common errors (CORS, network, mixed-content)
        console.error('Scan request failed:', err);
        if (err instanceof TypeError) {
          setStatus('فشل الفحص: غير قادر على الاتصال بالخادم. تحقق من أن الخادم يعمل وأن الصفحة تستخدم نفس البروتوكول (http/https).');
        } else {
          setStatus('فشل الفحص: ' + err.message);
        }
      }
    });
  </script>
  </body>
</html>
