
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>ุชูุฑูุฑ ุงููุญุต - ูุฒุงุฑุฉ ุงูุซูุงูุฉ ุงูุณุนูุฏูุฉ</title>
      <link rel="icon" href="/favicon.png" sizes="32x32" />
      <link rel="shortcut icon" href="/favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet">
      <style>
        :root {
          --primary: #062c6e;
          --accent: #2db9db;
          --muted: #6b7280;
        }
        body { font-family: 'IBM Plex Sans Arabic', Arial, sans-serif; margin: 0; background: #f4f7fb; direction: rtl; color: #0f1724; }
        .ltr { direction: ltr; text-align: left; }
        .rtl { direction: rtl; text-align: right; }
        .header { display: flex; justify-content: space-between; align-items: center; background: #fff; color:#fff; padding:20px 28px; border-bottom: 3px solid var(--primary); }
        .header img { height: 42px; }
        .report-title { font-size: 1.6rem; color: var(--primary); font-weight: 700; margin: 0; }
        @media print {
          @page { 
            size: A4; 
            margin: 20mm 12mm 20mm 12mm; 
          }
          * { 
            -webkit-print-color-adjust: exact !important; 
            print-color-adjust: exact !important;
            color-adjust: exact !important;
          }
          body { 
            padding: 0; 
            margin: 0;
            background: white !important; 
            font-size: 9.5pt;
            line-height: 1.3;
          }
          .header { 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 16mm;
            background: white !important;
            border-bottom: 1.5px solid var(--primary);
            padding: 4mm 12mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
          }
          .header img {
            height: 24px;
            max-width: 70px;
            object-fit: contain;
          }
          .header .report-title {
            font-size: 11pt;
            margin: 0;
            color: var(--primary);
            font-weight: 700;
            white-space: nowrap;
          }
          .footer { 
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 14mm;
            background: white;
            border-top: 1.5px solid var(--primary);
            padding: 3mm 12mm;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
          }
          .footer img {
            height: 22px;
            max-width: 60px;
            object-fit: contain;
          }
          .footer .info {
            flex: 1;
            text-align: center;
          }
          .footer .info div {
            font-size: 8pt;
            line-height: 1.2;
          }
          .footer .page-number {
            position: static;
            transform: none;
            margin: 0 15px;
            font-size: 9pt;
            font-weight: 600;
          }
          .container { 
            max-width: 100%; 
            padding: 0;
            margin: 18mm 0 16mm 0;
          }
          .card { 
            page-break-inside: avoid; 
            margin-bottom: 6px;
            box-shadow: none;
            border: 0.5px solid #d1d5db;
            padding: 8px 10px;
            border-radius: 4px;
          }
          h2 { 
            page-break-after: avoid; 
            font-size: 11pt;
            margin: 0 0 6px 0;
            font-weight: 700;
          }
          h3 { 
            page-break-after: avoid;
            font-size: 10pt;
            margin: 0 0 4px 0;
            font-weight: 600;
          }
          .meta {
            font-size: 8pt;
            margin-bottom: 4px;
          }
          table { 
            page-break-inside: auto;
            font-size: 8pt;
            width: 100%;
          }
          tr { 
            page-break-inside: avoid; 
            page-break-after: auto; 
          }
          td, th {
            padding: 4px 6px;
          }
          th {
            font-size: 8.5pt;
          }
          img { 
            max-width: 100%; 
            height: auto;
            page-break-inside: avoid;
          }
          .responsive-grid { 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
          }
          .responsive-cell {
            padding: 4px;
          }
          .responsive-cell .meta {
            font-size: 7pt;
            margin-bottom: 2px;
          }
          .responsive-cell img {
            max-height: 110px;
            width: 100%;
            object-fit: contain;
          }
          .three-col-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
          }
          .three-col-grid > div {
            padding: 8px;
            font-size: 8.5pt;
          }
          .three-col-grid h3 {
            font-size: 9pt;
          }
          .three-col-grid .meta {
            font-size: 7.5pt;
          }
          #color-failures-card {
            page-break-inside: auto;
          }
          #color-failures-card .meta {
            font-size: 7pt;
          }
          #color-failures-card > div {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
          }
          #color-failures-card > div > div {
            width: auto;
            padding: 4px;
            font-size: 7pt;
          }
          #color-failures-card img {
            height: 70px;
            width: 100%;
            object-fit: cover;
          }
          #failures-visible, #failures-hidden {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 6px !important;
          }
          .accuracy-bar {
            height: 12px;
            margin: 4px 0 8px 0;
          }
          .accuracy-label {
            font-size: 9pt;
          }
          .dropdown {
            margin-bottom: 6px;
          }
          .swatch {
            width: 16px;
            height: 16px;
            margin-right: 4px;
          }
          canvas#accuracyChart {
            max-height: 160px !important;
            max-width: 100% !important;
          }
          .card:first-child canvas {
            max-height: 140px !important;
          }
        }
        .container { max-width: 980px; margin: 18px auto; padding: 18px; }
        .card { background: white; padding: 16px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(15,23,36,0.08); margin-bottom: 16px; border: 1px solid #e5e7eb; }
        h2 { color: var(--primary); margin-top: 0; margin-bottom: 12px; }
        .meta { color: var(--muted); font-size: 0.98em; margin-bottom: 8px; }
        .swatch { display: inline-block; width: 24px; height: 24px; border: 1px solid #aaa; vertical-align: middle; margin-right: 8px; border-radius: 6px; }
        .match { background: #e6fff7; }
        .no-match { background: #ffe6e6; }
        .accuracy-bar { background: #eaf6fb; border-radius: 8px; height: 18px; margin: 8px 0 18px 0; position: relative; }
        .accuracy-fill { background: var(--accent); height: 100%; border-radius: 8px; transition: width .4s; }
        .accuracy-label { position: absolute; left: 50%; top: 0; transform: translateX(-50%); color: var(--primary); font-weight: 600; font-size: 1em; }
        .dropdown { margin-bottom: 18px; }
        select { font-size: 1em; padding: 6px 14px; border-radius: 8px; border: 1px solid #e6eefc; background: #f6f9ff; color: var(--primary); }
        .responsive-img { width: 100%; max-width: 420px; border-radius: 16px; box-shadow: 0 4px 16px #0003; background: #fff; margin-bottom: 8px; }
        .responsive-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .responsive-cell { background:#fff;padding:12px;border-radius:12px; }
        .filter-row { display: none; }
        .color-table-row { transition: opacity 0.2s; }
        /* Hide interactive controls when printing/exporting to PDF */
        @media print {
          .btn, .actions, .dropdown { display: none !important; }
          #failures-hidden { display: flex !important; }
          .color-table-row { display: table-row !important; opacity: 1 !important; }
        }
        /* Also support client-side export which toggles this class */
        .pdf-export .btn, .pdf-export .actions, .pdf-export .dropdown { display: none !important; }
        .pdf-export #failures-hidden { display: flex !important; }
        .pdf-export .color-table-row { display: table-row !important; opacity: 1 !important; }
        .thumbnail { width: 140px; height: 92px; object-fit: cover; border-radius: 10px; border: 2px solid var(--accent); cursor: pointer; transition: box-shadow .18s; }
        .thumbnail:hover { box-shadow: 0 2px 12px var(--accent); }
        .actions { display: flex; gap: 12px; margin-top: 10px; }
        .btn { background: var(--accent); color: #fff; border: none; border-radius: 8px; padding: 10px 18px; font-size: 1em; cursor: pointer; font-weight: 600; transition: background .18s; }
        .btn:hover { background: #1ca1c2; }
        .footer { background: white; border-top: 2px solid var(--primary); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; font-size: 0.9em; color: var(--muted); position: relative; }
        .footer .info { display: flex; flex-direction: column; gap: 6px; }
        .footer .info strong { color: var(--primary); font-weight: 700; font-size: 1.1em; }
        .footer img { height: 42px; margin-left: 18px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        .three-col-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 16px; }
        .footer .page-number { position: absolute; left: 50%; transform: translateX(-50%); font-weight: 600; color: var(--primary); display: none; }
        @media print {
          .footer .page-number { display: block; }
          .footer .page-number::before { content: "ุตูุญุฉ " counter(page); }
        }
        @media (max-width: 700px) {
          .header, .footer { flex-direction: column; align-items: flex-start; padding: 12px 8px; }
          .container { padding: 12px 8px; }
          .responsive-grid { grid-template-columns: 1fr; }
          .card > div[style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
          .btn { font-size: 14px; padding: 10px 14px; }
        }
      </style>
      <script>
        function showFullScreenshot(src) {
          const win = window.open('', '_blank');
          win.document.write('<img src="' + src + '" style="width:100%;max-width:1200px;display:block;margin:auto;">');
        }
        function downloadImage(src, name) {
          try {
            const a = document.createElement('a');
            a.href = src; 
            a.download = name; 
            a.setAttribute('download', name);
            document.body.appendChild(a); 
            a.click(); 
            document.body.removeChild(a);
          } catch (error) {
            console.error('Download failed:', error);
            alert('ูุดู ุชุญููู ุงูุตูุฑุฉ. ุฌุฑุจ ูุชุญ ุงูุตูุฑุฉ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ ูุงูููุฑ ุจุฒุฑ ุงููุงูุณ ุงูุฃููู ููุญูุธ.');
          }
        }
        async function exportPDF() {
          // Try server-side high-fidelity PDF first (best for Arabic/fonts/complex layout)
          const origin = (window.location && window.location.protocol === 'file:') ? 'http://localhost:3001' : window.location.origin;
          
          // Show loading indicator
          const loadingDiv = document.createElement('div');
          loadingDiv.id = 'pdf-loading';
          loadingDiv.innerHTML = '<div style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;"><div style="background:white;padding:30px;border-radius:12px;text-align:center;"><div style="font-size:1.5em;color:#062c6e;margin-bottom:10px">ุฌุงุฑู ุฅูุดุงุก PDF...</div><div style="font-size:14px;color:#666">ูุฑุฌู ุงูุงูุชุธุงุฑ</div></div></div>';
          document.body.appendChild(loadingDiv);
          
          try {
            const currentPath = (window.location && window.location.pathname) ? window.location.pathname : '/reports/report.html';
            const resp = await fetch(origin + '/report-pdf?path=' + encodeURIComponent(currentPath));
            if (resp.ok) {
              const blob = await resp.blob();
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'audit-report.pdf';
              document.body.appendChild(a);
              a.click();
              a.remove();
              URL.revokeObjectURL(url);
              document.body.removeChild(loadingDiv);
              return;
            }
            console.warn('Server-side PDF endpoint returned non-OK:', resp.status);
            document.body.removeChild(loadingDiv);
          } catch (e) {
            console.warn('Server-side PDF generation failed:', e);
            document.body.removeChild(loadingDiv);
          }

          // Fallback: use browser print dialog (better than client-side screenshot)
          alert('ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ูุฅูุดุงุก PDF. ุณูุชู ูุชุญ ูุงูุฐุฉ ุงูุทุจุงุนุฉ.\n\nูุตูุญุฉ: ุงุฎุชุฑ "ุญูุธ ูู PDF" ูู ุฎูุงุฑุงุช ุงูุทุจุงุนุฉ ููุญุตูู ุนูู ุฃูุถู ูุชูุฌุฉ.');
          // Show all content before printing
          const hiddenFailures = document.getElementById('failures-hidden');
          if (hiddenFailures) hiddenFailures.style.display = 'flex';
          const colorFilter = document.getElementById('color-filter');
          if (colorFilter) {
            colorFilter.value = 'all';
            const rows = document.querySelectorAll('.color-table-row');
            rows.forEach(row => { row.style.display = 'table-row'; row.style.opacity = '1'; });
          }
          window.print();
        }
        function switchResponsive() {
          const sel = document.getElementById('responsive-select');
          const img = document.getElementById('responsive-img');
          img.src = sel.value;
        }
        function filterColorTable(filter) {
          const rows = document.querySelectorAll('.color-table-row');
          rows.forEach(row => {
            if (filter === 'all') {
              row.style.display = 'table-row';
              row.style.opacity = '1';
            } else if (row.dataset.match === filter) {
              row.style.display = 'table-row';
              row.style.opacity = '1';
            } else {
              row.style.display = 'none';
              row.style.opacity = '0';
            }
          });
        }
      </script>
    </head>
    <body>
      <div id="report-root">
      <div class="header">
        <img src="https://ramworld.net/Ramworld_Logo_Main.png" alt="Ramworld Logo" style="height:48px;max-width:120px;object-fit:contain;order:1;">
        <span class="report-title" style="order:2;">ุชูุฑูุฑ ูุญุต ุงูุชูุงูู ูุน ูุนุงููุฑ ุงูุชุตููู ุงูููุญุฏ</span>
        <img src="/reports/logo.png" alt="Entity Logo" style="height:48px;max-width:120px;object-fit:contain;order:3;">
      </div>
      <div class="container">
        <div class="card">
          <!-- Summary Card: Website Name, URL, Timestamp -->
          <div class="summary-card" style="background:linear-gradient(135deg,#f6f9ff,#fff);border:2px solid var(--accent);border-radius:12px;padding:18px 24px;margin:0 0 18px 0;box-shadow:0 2px 8px rgba(45,185,219,0.08);display:flex;flex-direction:column;gap:10px;align-items:flex-start">
            <div style="font-size:1.25em;font-weight:700;color:var(--primary);margin-bottom:2px">
              <span style="margin-left:8px">ุงุณู ุงููููุน:</span> <span style="color:#2563eb">ูุฒุงุฑุฉ ุงูุซูุงูุฉ ุงูุณุนูุฏูุฉ</span>
            </div>
            <div style="font-size:1.1em;color:#0f172a;word-break:break-all">
              <span style="margin-left:8px">ุงูุฑุงุจุท:</span> <a href="https://moc.gov.sa" target="_blank" style="color:var(--accent);text-decoration:underline">https://moc.gov.sa</a>
            </div>
            <div style="font-size:1em;color:#475569">
              <span style="margin-left:8px">ุชุงุฑูุฎ ุงููุญุต:</span> ูข ุฏูุณูุจุฑ ูขููขูฅ ูู ูกูข:ููฉ ู
            </div>
          </div>
          <h2>ูุธุฑุฉ ุนุงูุฉ ุนูู ุฏูุฉ ุงูุชูุงูู</h2>
          <div style="max-width:500px;margin:20px auto;position:relative;height:300px">
            <canvas id="accuracyChart"></canvas>
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:24px">
            <div style="background:linear-gradient(135deg,#e6fff7,#fff);padding:16px;border-radius:10px;border:2px solid #16a34a;text-align:center">
              <div style="font-size:2em;font-weight:700;color:#16a34a">81.3%</div>
              <div style="color:#15803d;margin-top:4px">ุฏูุฉ ุงูุฃููุงู</div>
            </div>
            <div style="background:linear-gradient(135deg,#eff6ff,#fff);padding:16px;border-radius:10px;border:2px solid var(--accent);text-align:center">
              <div style="font-size:2em;font-weight:700;color:var(--accent)">33.3%</div>
              <div style="color:var(--primary);margin-top:4px">ุฏูุฉ ุงููุณุงูุงุช</div>
            </div>
            <div style="background:linear-gradient(135deg,#e6fff7,#fff);padding:16px;border-radius:10px;border:2px solid #16a34a;text-align:center">
              <div style="font-size:1.8em;font-weight:700;color:#16a34a">โ</div>
              <div style="color:#15803d;margin-top:4px">ุฎุท IBM Plex</div>
            </div>
            <div style="background:linear-gradient(135deg,#e6fff7,#fff);padding:16px;border-radius:10px;border:2px solid #16a34a;text-align:center">
              <div style="font-size:1.8em;font-weight:700;color:#16a34a">โ</div>
              <div style="color:#15803d;margin-top:4px">ุฎุชู ุงูุชุญูู</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>ููุงุฑูุฉ ุงูุฎุทูุท</h2>
          <div class="meta"><strong>ูุชูุฌุฉ ุงููุดู ุนู ุฎุท ุงููููุฉ (IBM Plex):</strong> โ๏ธ ููุชุดู</div>
        </div>
        
        <div class="card">
          <h2>ุฌุฏูู ูุทุงุจูุฉ ุงูุฃููุงู</h2>
          <div class="meta"><strong>Color Accuracy:</strong> 81.3%</div>
          <div class="accuracy-bar"><div class="accuracy-fill" style="width:81.3%;background:#16a34a"></div><span class="accuracy-label" style="color:#16a34a">81.3%</span></div>
          <div class="dropdown" style="margin-bottom:12px">
            <label for="color-filter" style="margin-left:8px;font-weight:600;color:var(--primary)">ุชุตููุฉ ุงูุฃููุงู:</label>
            <select id="color-filter" onchange="filterColorTable(this.value)">
              <option value="all">ุฌููุน ุงูุฃููุงู</option>
              <option value="correct">ุงูุฃููุงู ุงูุตุญูุญุฉ ููุท</option>
              <option value="wrong">ุงูุฃููุงู ุงูุฎุงุทุฆุฉ ููุท</option>
            </select>
          </div>
          <table style="width:100%;border-collapse:collapse;" id="color-table">
            <thead>
              <tr style="background:var(--accent);color:#fff;">
                <th>ููู ุงููููุน</th>
                <th>ุฃูุฑุจ ููู ูููููุฉ</th>
                <th>ุงููุณุงูุฉ</th>
                <th>ูุทุงุจูุฉ</th>
              </tr>
            </thead>
            <tbody>
              
                <tr class="color-table-row no-match" data-match="wrong">
                  <td><span class="swatch" style="background:rgb(0, 0, 0)"></span>rgb(0, 0, 0)</td>
                  <td><span class="swatch" style="background:rgb(13,18,28)"></span>rgb(13,18,28)</td>
                  <td>35.7</td>
                  <td>โ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(229, 231, 235)"></span>rgb(229, 231, 235)</td>
                  <td><span class="swatch" style="background:rgb(229,231,235)"></span>rgb(229,231,235)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(255, 255, 255)"></span>rgb(255, 255, 255)</td>
                  <td><span class="swatch" style="background:rgb(252,252,253)"></span>rgb(252,252,253)</td>
                  <td>4.7</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(243, 244, 246)"></span>rgb(243, 244, 246)</td>
                  <td><span class="swatch" style="background:rgb(243,244,246)"></span>rgb(243,244,246)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(27, 131, 84)"></span>rgb(27, 131, 84)</td>
                  <td><span class="swatch" style="background:rgb(27,131,84)"></span>rgb(27,131,84)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(22, 22, 22)"></span>rgb(22, 22, 22)</td>
                  <td><span class="swatch" style="background:rgb(13,18,28)"></span>rgb(13,18,28)</td>
                  <td>11.5</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(56, 66, 80)"></span>rgb(56, 66, 80)</td>
                  <td><span class="swatch" style="background:rgb(56,66,80)"></span>rgb(56,66,80)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(210, 214, 219)"></span>rgb(210, 214, 219)</td>
                  <td><span class="swatch" style="background:rgb(210,214,219)"></span>rgb(210,214,219)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgba(9, 42, 30, 0.8)"></span>rgba(9, 42, 30, 0.8)</td>
                  <td><span class="swatch" style="background:rgb(9,42,30)"></span>rgb(9,42,30)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(31, 42, 55)"></span>rgb(31, 42, 55)</td>
                  <td><span class="swatch" style="background:rgb(31,42,55)"></span>rgb(31,42,55)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(15, 40, 55)"></span>rgb(15, 40, 55)</td>
                  <td><span class="swatch" style="background:rgb(31,42,55)"></span>rgb(31,42,55)</td>
                  <td>16.1</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(157, 164, 174)"></span>rgb(157, 164, 174)</td>
                  <td><span class="swatch" style="background:rgb(157,164,174)"></span>rgb(157,164,174)</td>
                  <td>0.0</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row no-match" data-match="wrong">
                  <td><span class="swatch" style="background:rgba(0, 0, 0, 0.314)"></span>rgba(0, 0, 0, 0.314)</td>
                  <td><span class="swatch" style="background:rgb(13,18,28)"></span>rgb(13,18,28)</td>
                  <td>35.7</td>
                  <td>โ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(29, 28, 29)"></span>rgb(29, 28, 29)</td>
                  <td><span class="swatch" style="background:rgb(17,25,39)"></span>rgb(17,25,39)</td>
                  <td>15.9</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row match" data-match="correct">
                  <td><span class="swatch" style="background:rgb(248, 248, 248)"></span>rgb(248, 248, 248)</td>
                  <td><span class="swatch" style="background:rgb(249,250,251)"></span>rgb(249,250,251)</td>
                  <td>3.7</td>
                  <td>โ๏ธ</td>
                </tr>
              
                <tr class="color-table-row no-match" data-match="wrong">
                  <td><span class="swatch" style="background:rgb(18, 100, 163)"></span>rgb(18, 100, 163)</td>
                  <td><span class="swatch" style="background:rgb(37,147,95)"></span>rgb(37,147,95)</td>
                  <td>84.8</td>
                  <td>โ</td>
                </tr>
              
            </tbody>
          </table>
        </div>
        
        
        <!-- Removed unique color set display per request -->
        <div class="card">
          <h2>ุนูุงุตุฑ ุงูุชุตููู ุงูุฃุณุงุณูุฉ</h2>
          <div class="three-col-grid">
            <div style="background:linear-gradient(135deg,#e6fff7,#fff);padding:20px;border-radius:12px;border:2px solid #16a34a;text-align:center">
              <div style="font-size:3em;margin-bottom:8px">โ</div>
              <h3 style="color:#16a34a;margin:0 0 8px 0;font-size:1.1em">ุฎุชู ุงูุชุญูู</h3>
              <div class="meta" style="color:#15803d">ุชู ุงููุดู</div>
              <div style="margin-top:12px;padding:10px;background:rgba(255,255,255,0.6);border-radius:8px;font-size:0.85em;color:#15803d">ูููุน ุญูููู ููุซู: ูุญุชูู ุนูู ุงููุต ุงูุฑุณูู + ุฑูู + ุนูู ุงูููููุฉ</div>
            </div>
            <div style="background:linear-gradient(135deg,#ffe6e6,#fff);padding:20px;border-radius:12px;border:2px solid #dc2626;text-align:center">
              <div style="font-size:3em;margin-bottom:8px">โ</div>
              <h3 style="color:#dc2626;margin:0 0 8px 0;font-size:1.1em">ุดุฑูุท ุงูุจุญุซ</h3>
              <div class="meta" style="color:#991b1b">ุบูุฑ ููุฌูุฏ</div>
            </div>
            <div style="background:linear-gradient(135deg,#ffe6e6,#fff);padding:20px;border-radius:12px;border:2px solid #dc2626;text-align:center">
              <div style="font-size:2.5em;margin-bottom:8px;color:#dc2626;font-weight:700">33.3%</div>
              <h3 style="color:#dc2626;margin:0 0 8px 0;font-size:1.1em">ุฏูุฉ ุงููุณุงูุงุช</h3>
              <div class="meta" style="color:#991b1b">ูุญุชุงุฌ ุชุญุณูู</div>
            </div>
          </div>
        </div>

        <!-- AI Recommendations Section -->
        <div class="card" style="background:linear-gradient(135deg,#f0f9ff,#fff);border:2px solid var(--accent)">
          <h2 style="display:flex;align-items:center;gap:10px">
            <svg viewBox="0 0 24 24" style="width:28px;height:28px" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5"/></svg>
            ุชูุตูุงุช ุงูุชุญุณูู (AI)
          </h2>
          <div style="color:#0f1724;line-height:1.8;margin-top:16px">
            
                <div style="margin-bottom:20px;padding:20px;background:white;border-radius:12px;border-right:4px solid #16a34a;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
                  <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
                    <span style="font-size:2em">โ</span>
                    <div style="flex:1">
                      <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
                        <h3 style="margin:0;color:#16a34a;font-size:1.2em">ุชูุงูู ููุชุงุฒ ููุฃููุงู</h3>
                        <span style="background:#16a34a;color:white;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700">ููุชุงุฒ</span>
                      </div>
                    </div>
                  </div>
                  <p style="margin:0 0 12px 0;color:#4b5563;line-height:1.7">ุฏูุฉ ุงูุฃููุงู ููุชุงุฒุฉ (81.3%). ุงููููุน ูุณุชุฎุฏู ุฃููุงู ุงููููุฉ ุจุดูู ุตุญูุญ. ุงุณุชูุฑ ูู ุงูุญูุงุธ ุนูู ูุฐุง ุงููุณุชูู.</p>
                  <div style="background:#f9fafb;padding:12px 16px;border-radius:8px;border-right:3px solid #16a34a">
                    <strong style="color:#1f2937">ุงูุฅุฌุฑุงุก ุงูููุชุฑุญ:</strong>
                    <div style="color:#4b5563;margin-top:6px">ุงูุญูุงุธ ุนูู ุงุณุชุฎุฏุงู ุฃููุงู ุงููููุฉ ูู ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ</div>
                  </div>
                </div>
              
                <div style="margin-bottom:20px;padding:20px;background:white;border-radius:12px;border-right:4px solid #dc2626;box-shadow:0 2px 8px rgba(0,0,0,0.08)">
                  <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
                    <span style="font-size:2em">๐</span>
                    <div style="flex:1">
                      <div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">
                        <h3 style="margin:0;color:#dc2626;font-size:1.2em">ุฅุตูุงุญ ูุธุงู ุงููุณุงูุงุช</h3>
                        <span style="background:#dc2626;color:white;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700">ุนุงูู</span>
                      </div>
                    </div>
                  </div>
                  <p style="margin:0 0 12px 0;color:#4b5563;line-height:1.7">ุฏูุฉ ุงููุณุงูุงุช (33.3%) ุชุญุชุงุฌ ุฅูู ุชุญุณูู ูุจูุฑ. ุงููุณุงูุงุช ุบูุฑ ุงููุชุณูุฉ ุชุคุซุฑ ุนูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูุงููุธูุฑ ุงูุงุญุชุฑุงูู ูููููุน.</p>
                  <div style="background:#f9fafb;padding:12px 16px;border-radius:8px;border-right:3px solid #dc2626">
                    <strong style="color:#1f2937">ุงูุฅุฌุฑุงุก ุงูููุชุฑุญ:</strong>
                    <div style="color:#4b5563;margin-top:6px">ุชุทุจูู ูุธุงู ุงููุณุงูุงุช ุงูููุญุฏ (4px, 8px, 12px, 16px, 24px, 32px, 48px) ูู ุฌููุน ุงูุนูุงุตุฑ</div>
                  </div>
                </div>
              
          </div>
        </div>

        
        <div class="card">
          <h2>ุตูุฑุฉ ูุงููุฉ ููุตูุญุฉ ู ุชุตุฏูุฑ ุงูุชูุฑูุฑ</h2>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:16px">
            <div>
              <h3 style="color:var(--primary);font-size:1.1rem;margin-bottom:12px">ูุนุงููุฉ ุงูุตูุญุฉ</h3>
              <img src="/reports/snap-1764666571396.png" class="thumbnail" alt="Full Screenshot" onclick="showFullScreenshot('/reports/snap-1764666571396.png')" style="width:100%;height:auto;max-height:300px;object-fit:contain;border:2px solid var(--accent);border-radius:12px;cursor:pointer;transition:transform 0.2s" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
              <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
                <button class="btn" onclick="showFullScreenshot('/reports/snap-1764666571396.png')" style="flex:1;min-width:140px">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;margin-left:6px;display:inline-block;vertical-align:middle" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                  ุนุฑุถ ุจุงูุญุฌู ุงููุงูู
                </button>
                <button class="btn" onclick="downloadImage('/reports/snap-1764666571396.png','full-screenshot.png')" style="flex:1;min-width:140px;background:#16a34a">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;margin-left:6px;display:inline-block;vertical-align:middle" fill="currentColor"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"/></svg>
                  ุชุญููู PNG
                </button>
              </div>
            </div>
            <div style="background:linear-gradient(135deg,#f6f9ff,#fff);padding:20px;border-radius:12px;border:2px solid var(--primary-rgba-12)">
              <h3 style="color:var(--primary);font-size:1.1rem;margin-bottom:16px;display:flex;align-items:center">
                <svg viewBox="0 0 24 24" style="width:20px;height:20px;margin-left:8px" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg>
                ุชุตุฏูุฑ ุงูุชูุฑูุฑ
              </h3>
              <div style="color:var(--muted);font-size:14px;margin-bottom:16px;line-height:1.6">ุงุญูุธ ุงูุชูุฑูุฑ ุงููุงูู ุจุตูุบุฉ PDF ูุน ุฌููุน ุงููุชุงุฆุฌ ูุงูุตูุฑ ูุงูุชุญูููุงุช. ูุซุงูู ูููุดุงุฑูุฉ ุฃู ุงูุฃุฑุดูุฉ.</div>
              <button class="btn" onclick="exportPDF()" style="width:100%;padding:14px;font-size:16px;font-weight:700;background:var(--primary);display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 12px rgba(6,44,110,0.3)">
                <svg viewBox="0 0 24 24" style="width:20px;height:20px" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm1 10h-4v5h-2v-5H5l7-7 7 7z"/></svg>
                ุชุตุฏูุฑ ุฅูู PDF
              </button>
              <div style="margin-top:12px;padding:12px;background:rgba(45,185,219,0.1);border-radius:8px;border-right:3px solid var(--accent)">
                <div style="font-size:12px;color:var(--muted);line-height:1.5">
                  <strong style="color:var(--accent)">๐ก ููุงุญุธุฉ:</strong> ุณูุชู ุชุถููู ุฌููุน ุงูุฃููุงู ูุงูุนูุงุตุฑ ุบูุฑ ุงููุชูุงููุฉ ุชููุงุฆูุงู ูู ุงูุชูุฑูุฑ ุงููุตุฏุฑ.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <img src="https://ramworld.net/Ramworld_Logo_Main.png" alt="Ramworld Logo" style="order:1;">
        <div class="info" style="order:2;">
          <div style="font-size:10pt;font-weight:600;color:var(--primary)">ูุฏูู ุงูุชุตููู ุงูููุญุฏ</div>
          <div class="ltr" style="font-size:9pt;color:#6b7280;margin-top:2px">www.ramworld.net | +966 55 506 7508</div>
        </div>
        <div class="page-number" style="font-size:10pt;font-weight:600;color:var(--primary);order:3;"></div>
        <img src="/reports/logo.png" alt="Entity Logo" style="order:4;">
      </div>
      </div>
      <script>
        // Ensure functions are in global scope
        window.showFullScreenshot = function(src) {
          const win = window.open('', '_blank');
          win.document.write('<img src="' + src + '" style="width:100%;max-width:1200px;display:block;margin:auto;">');
        };
        
        window.downloadImage = function(src, name) {
          try {
            const a = document.createElement('a');
            a.href = src; 
            a.download = name; 
            a.setAttribute('download', name);
            document.body.appendChild(a); 
            a.click(); 
            document.body.removeChild(a);
          } catch (error) {
            console.error('Download failed:', error);
            alert('ูุดู ุชุญููู ุงูุตูุฑุฉ. ุฌุฑุจ ูุชุญ ุงูุตูุฑุฉ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ ูุงูููุฑ ุจุฒุฑ ุงููุงูุณ ุงูุฃููู ููุญูุธ.');
          }
        };
        
        window.exportPDF = async function() {
          const origin = (window.location && window.location.protocol === 'file:') ? 'http://localhost:3001' : window.location.origin;
          
          const loadingDiv = document.createElement('div');
          loadingDiv.id = 'pdf-loading';
          loadingDiv.innerHTML = '<div style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;"><div style="background:white;padding:30px;border-radius:12px;text-align:center;"><div style="font-size:1.5em;color:#062c6e;margin-bottom:10px">ุฌุงุฑู ุฅูุดุงุก PDF...</div><div style="font-size:14px;color:#666">ูุฑุฌู ุงูุงูุชุธุงุฑ</div></div></div>';
          document.body.appendChild(loadingDiv);
          
          try {
            const currentPath = (window.location && window.location.pathname) ? window.location.pathname : '/reports/report.html';
            const resp = await fetch(origin + '/report-pdf?path=' + encodeURIComponent(currentPath));
            if (resp.ok) {
              const blob = await resp.blob();
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'audit-report.pdf';
              document.body.appendChild(a);
              a.click();
              a.remove();
              URL.revokeObjectURL(url);
              document.body.removeChild(loadingDiv);
              return;
            }
            document.body.removeChild(loadingDiv);
          } catch (e) {
            console.warn('Server-side PDF generation failed:', e);
            document.body.removeChild(loadingDiv);
          }
          
          alert('ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ูุฅูุดุงุก PDF. ุณูุชู ูุชุญ ูุงูุฐุฉ ุงูุทุจุงุนุฉ.\n\nูุตูุญุฉ: ุงุฎุชุฑ "ุญูุธ ูู PDF" ูู ุฎูุงุฑุงุช ุงูุทุจุงุนุฉ ููุญุตูู ุนูู ุฃูุถู ูุชูุฌุฉ.');
          const hiddenFailures = document.getElementById('failures-hidden');
          if (hiddenFailures) hiddenFailures.style.display = 'flex';
          const colorFilter = document.getElementById('color-filter');
          if (colorFilter) {
            colorFilter.value = 'all';
            const rows = document.querySelectorAll('.color-table-row');
            rows.forEach(row => { row.style.display = 'table-row'; row.style.opacity = '1'; });
          }
          window.print();
        };
        
        // Initialize Chart.js accuracy chart
        window.addEventListener('DOMContentLoaded', function() {
          const ctx = document.getElementById('accuracyChart');
          if (ctx && window.Chart) {
            const colorAcc = 81.3;
            const spacingAcc = 33.3;
            const fontScore = 100;
            const stampScore = 100;
            const searchScore = 0;
            
            new Chart(ctx, {
              type: 'doughnut',
              data: {
                labels: ['ุงูุฃููุงู', 'ุงููุณุงูุงุช', 'ุงูุฎุท', 'ุฎุชู ุงูุชุญูู', 'ุดุฑูุท ุงูุจุญุซ'],
                datasets: [{
                  data: [colorAcc, spacingAcc, fontScore, stampScore, searchScore],
                  backgroundColor: [
                    'rgba(22, 163, 74, 0.8)',
                    'rgba(45, 185, 219, 0.8)',
                    'rgba(251, 191, 36, 0.8)',
                    'rgba(139, 92, 246, 0.8)',
                    'rgba(239, 68, 68, 0.8)'
                  ],
                  borderColor: [
                    'rgba(22, 163, 74, 1)',
                    'rgba(45, 185, 219, 1)',
                    'rgba(251, 191, 36, 1)',
                    'rgba(139, 92, 246, 1)',
                    'rgba(239, 68, 68, 1)'
                  ],
                  borderWidth: 2
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                  legend: {
                    position: 'bottom',
                    labels: {
                      font: { size: 14, family: 'IBM Plex Sans Arabic' },
                      padding: 15,
                      usePointStyle: true
                    }
                  },
                  title: {
                    display: true,
                    text: 'ููุงููุณ ุงูุชูุงูู ูุน ูุนุงููุฑ ุงูุชุตููู ุงูููุญุฏ',
                    font: { size: 18, family: 'IBM Plex Sans Arabic', weight: '700' },
                    color: '#062c6e',
                    padding: { top: 10, bottom: 20 }
                  },
                  tooltip: {
                    callbacks: {
                      label: function(context) {
                        return context.label + ': ' + context.parsed + '%';
                      }
                    },
                    bodyFont: { family: 'IBM Plex Sans Arabic', size: 14 },
                    titleFont: { family: 'IBM Plex Sans Arabic', size: 16 }
                  }
                }
              }
            });
          }
        });
      </script>

    </body>
    </html>
  